!function(a,b,c){function d(b,c){this.element=b,this.options=a.extend({},l,c),this.init()}function e(){var a=this.map||{};return{center:a.center,zoom:a.zoomLevel,bbox:a.getViewBounds&&a.getViewBounds(),type:this.mtype}}function f(a,b){var c=new o.kml.Manager;c.addObserver("state",u(function(a){"finished"===a.state&&b.call(this,a)},this)),c.parseKML(a)}function g(b){var c=b.target,d=this.map.pixelToGeo(b.displayX,b.displayY);c===this.map&&(b.type="map"+b.type,a(this.element).trigger(i(b,d)))}function h(a){var b=a.target,c=b[a.type];j(c)&&c.call(this.element,i(a,b.coordinate))}function i(b,c){return a.Event(b.type,{originalEvent:b,geo:{latitude:c.latitude,longitude:c.longitude},target:b.target})}function j(a){return"function"==typeof a}function k(){return!!a().on}var l,m,n,o,p,q,r,s,t="jHERE",u=a.proxy,v="mouse",w="click",x="drag",y="touch",z="start",A="end",B="move",C="appId",D="authenticationToken",E=[w,"dbl"+w,v+"up",v+"down",v+B,v+"over",v+"out",v+"enter",v+"leave","longpress",x+z,x,x+A,"resize",y+z,y+A,y+B];l={appId:"69Dgg78qt4obQKxVbRA8",authToken:"Nz7ilIB_v1CRwPXxgPdvuA",zoom:12,center:[52.49,13.37],enable:["behavior","zoombar","scalebar","typeselector"],type:"map",marker:{text:"",textColor:"#333333",fill:"#ff6347",stroke:"#333333",shape:"balloon",icon:void 0},bubble:{content:"",closable:!0,onclose:a.noop},heatmap:{max:20,opacity:.8,coarseness:2}},a[t]=s={},m=d.prototype,s.defaultCredentials=function(a,b){r={id:a,token:b},q.load().is.done(function(){n.Settings.set(C,a),n.Settings.set(D,b)})},m.init=function(){q.load().is.done(u(this.makemap,this))},m.makemap=function(){var b=this,c=b.options,d=p.component,e=[],f=u(g,b),h={};d.Positioning=o.positioning.component.Positioning,r=r||{id:c.appId,token:c.authToken},n.Settings.set(C,r.id),n.Settings.set(D,r.token),a.data(b.element,t,!0),a.each(d,u(function(c,d){return c=c.toLowerCase(),~a.inArray(c,b.options.enable)?j(d)&&e.push(new d)||a.error("invalid: "+c):void 0},b)),b.map=new p.Display(b.element,{zoomLevel:c.zoom,center:c.center,components:e}),b.type(c.type),b._mc=new p.Container,b.map.objects.add(b._mc),a.each(E,function(a,b){h[b]=[f,!1,null]}),b.map.addListeners(h)},m.center=function(a){this.map.setCenter(a)},m.zoom=function(a){this.map.set("zoomLevel",a)},m.type=function(a){var b=this.map,c={map:b.NORMAL,satellite:b.SATELLITE,smart:b.SMARTMAP,terrain:b.TERRAIN,pt:b.SMART_PT,community:b.NORMAL_COMMUNITY,satcommunity:b.SATELLITE_COMMUNITY,traffic:b.TRAFFIC};a in c?(this.mtype=a,a=c[a]):(this.mtype="map",a=c.map),b.set("baseMapType",a)},m.marker=function(b,c){var d={},e=u(h,this),f=this._mc,g="Marker";a.each(E,function(a,b){d[b]=[e,!1,null]}),c=a.extend({},l.marker,c),c.textPen=c.textPen||{strokeColor:c.textColor},c.pen=c.pen||{strokeColor:c.stroke},c.brush=c.brush||{color:c.fill},c.eventListener=d,c.icon||(g="Standard"+g),f.objects.add(new p[g](b,c))},m.nomarkers=function(){this._mc.objects.clear()},m.bubble=function(b,c){var d,e=this.map;c=a.extend({},l.bubble,c),c.content.jquery&&(c.content.css("white-space","normal"),c.content=a("<div/>").append(c.content.clone()).html()),d=e.getComponentById("InfoBubbles")||e.addComponent(new p.component.InfoBubbles),d.openBubble(c.content,{latitude:b.latitude||b[0],longitude:b.longitude||b[1]},c.onclose,!c.closable)},m.nobubbles=function(){var a;return(a=this.map.getComponentById("InfoBubbles"))&&a.closeAll()},m.kml=function(a,b,c){j(b)&&(c=b,b=!1),f.call(this,a,u(function(a){var d=this.map,e=new o.kml.component.KMLResultSet(a.kmlDocument,d);e.addObserver("state",u(function(a){var e,f;"finished"===a.state&&(b&&(e=a.container.objects.get(0),f=e.getBoundingBox(),f&&d.zoomTo(f)),j(c)&&c.call(this,a))},this)),d.objects.add(e.create())},this))},m.heatmap=function(b,c,d){var e;c=c||"value",c.match(/^density|value$/)||(c="value"),d=d||{},d.type=c,d=a.extend({},l.heatmap,d),e=new o.heatmap.Overlay(d),e.addData(b),this.map.overlays.add(e)},m.originalMap=function(a){a.call(this.element,this.map,o)},m.destroy=function(){this.map.destroy(),a.removeData(this.element),a(this.element).empty()},q={},q.is=!1,q.load=function(){var b,d,e;return q.is&&q.is.state().match(/pending|resolved/)?this:(q.is=a.Deferred(),e=function(){n=nokia,o=n.maps,n.Features.load({map:"auto",ui:"auto",search:"auto",routing:"auto",positioning:"auto",behavior:"auto",kml:"auto",heatmap:"auto"},function(){p=o.map,q.is.resolve()})},b=c.getElementsByTagName("head")[0],d=c.createElement("script"),d.src="http://js.api.here.com/se/2.5.4/jsl.js",d.type="text/javascript",d.charset="utf-8",d.onreadystatechange=function(){d.readyState.match(/loaded|complete/)&&e()},d.onload=e,b.appendChild(d),this)},s._JSLALoader=q,s.extend=function(a,b){"string"==typeof a&&j(b)&&(m[a]=b)},a.fn[t]=function(b){var c,f=arguments,g="plg_"+t;return k()||a.error(t+" requires Zepto or jQuery >= 1.7"),!b&&(c=a.data(this[0],g))?e.call(c):this.each(function(){var e;c=a.data(this,g),c?("string"!=typeof b&&a.error(t+" already initialized, expected method."),e=b,f=Array.prototype.slice.call(f,1),j(c[e])||a.error(t+": "+e+" does not exist"),q.load().is.done(function(){c[e].apply(c,f)})):(c=new d(this,b),a.data(this,g,c))})}}(jQuery,window,document);